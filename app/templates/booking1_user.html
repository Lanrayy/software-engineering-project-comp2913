{% extends "base.html" %}
{% block content %}
  <h1>Make a Booking</h1>

  <!-- Location ... No. Scooters Available -->
  <form  method="post" name="bookingform">
    {{ form.csrf_token }}
    {{ form.hidden_tag() }}
    <p>
      Choose a Collection Point <br>
      {{ form.location_id }}
    </p>
    <p>
      Choose a Scooter <br>
      {{ form.scooter_id }}
    </p>
    <p>
      Select a Hire Period <br>
      {{ form.hire_period }}
    </p>
    <p>
      Select a Start Time and Date (yyyy-mm-dd hours:minutes)<br>
      {{ form.start_date }}
    </p>
    {% if card_found %}
      <strong>Saved Card Details:</strong>
      <p>Name on Card: {{ data.name }} <br>Card No: XXXX XXXX XXXX {{ data.last_four}} <br>Expiry: {{ data.expiry_date.month }} / {{ data.expiry_date.year }}</p>
    {% endif %}
    <p><input type="submit" value="Go to Payment"></p>
  </form>

  <script>
    let location_select = document.getElementById('location_id');
    let scooter_select = document.getElementById('scooter_id');

    location_select.onchange = function() {
      location_id = location_select.value;

      fetch('booking1/' + location_id).then(function(response) {
        response.json().then(function(data) {
          let optionHTML = '';
          let count = 0;
          for(let scooter of data.scooters) {
            optionHTML += '<option value = "' + scooter.id + '">' + "Scooter ID: " + scooter.id + '</option>';
            count++;
          }

          if(count == 0) {
            optionHTML = '<option value = "0">No Scooters Available</option>';
          }

          scooter_select.innerHTML = optionHTML;
        });
      });
    }
  </script>
{% endblock %}
